<!DOCTYPE html>
<!--
/*
 * Copyright (c) 2014 NVIDIA CORPORATION. All Rights Reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * * Redistributions of source code must retain the above copyright
 *   notice, this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 * * Neither the name of NVIDIA CORPORATION nor the names of its
 *   contributors may be used to endorse or promote products derived
 *   from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
 -->
<html>
<head>
<title>J3DIMath unit test</title>
<script src="J3DIMath.js"></script>
<script>
var log = function(msg) {
    var p = document.createElement('p');
    if (msg.indexOf('FAIL') == 0) {
        p.style.color = '#900';
    } else if (msg.indexOf('PASS') == 0) {
        p.style.color = '#090';
    }
    p.textContent = msg;
    document.body.appendChild(p);
    console.log(msg);
};

var check = function(result, msg) {
    if (result) {
        log('PASS ' + msg);
    } else {
        log('FAIL ' + msg);
    }
};

var testMultiplication = function() {
    var A = new J3DIMatrix4();
    var B = new J3DIMatrix4();
    A.$matrix.m21 = 3; // 2nd column, 1st row
    B.$matrix.m12 = 2; // 1st column, 2nd row
    A.multiply(B); // multiply from the right
    // [ 1 3 0 0 ]   [ 1 0 0 0 ]   [ 7 3 0 0 ]
    // | 0 1 0 0 | x | 2 1 0 0 | = | 2 1 0 0 |
    // | 0 0 1 0 |   | 0 0 1 0 |   | 0 0 1 0 |
    // [ 0 0 0 1 ]   [ 0 0 0 1 ]   [ 0 0 0 1 ]
    check(A.$matrix.m11 == 7 && A.$matrix.m12 == 2 && A.$matrix.m21 == 3 && A.$matrix.m22 == 1,
          'Matrix multiplication order is as specified');
};

var testFloatArrayIO = function() {
    // Column major order
    var array = [ 7, 2, 0, 0,
                  3, 1, 0, 0,
                  0, 0, 1, 0,
                  0, 0, 0, 1 ];
    var A = new J3DIMatrix4(array);
    check(A.$matrix.m11 == 7 && A.$matrix.m12 == 2 && A.$matrix.m21 == 3 && A.$matrix.m22 == 1,
          'Matrix can be constructed from column-major array');
    var outArray = A.getAsArray();
    var match = true;
    for (var i = 0; i < array.length; ++i) {
        match = match && array[i] == outArray[i];
    }
    check(match, 'Matrix array out matches array in');
};

var testCrossProduct = function() {
    var a = new J3DIVector3(1, 5, 11);
    var b = new J3DIVector3(3, 7, 13);
    a.cross(b);
    var arr = a.getAsArray();
    check(arr[0] == 5 * 13 - 11 * 7, 'Vector cross product x is correct');
    check(arr[1] == 11 * 3 - 1 * 13, 'Vector cross product y is correct');
    check(arr[2] == 1 * 7 - 5 * 3, 'Vector cross product z is correct');
};

var testLinearAlgebra = function(useCSSMatrix) {
    J3DIHasCSSMatrix = useCSSMatrix;
    log('Using CSSMatrix: ' + J3DIHasCSSMatrix);

    testMultiplication();
    testFloatArrayIO();
    testCrossProduct();
};

var test = function() {
    testLinearAlgebra(false);
    testLinearAlgebra(true);
};
</script>
</head>
<body onload="test()">
</body>
</html>
